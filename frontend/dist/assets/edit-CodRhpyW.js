import{bw as pe,r as v,j as e,b9 as ue,M as B,aW as N,aY as ee,aX as $,bo as fe,c as ye,bp as ge,bq as be,b1 as Ie,G as t,S as a,J as j,U as _,n as C,V as we,B as y,Y as D,b4 as T,a$ as ie,b0 as ne,T as x,d as A,K as te,br as _e,F as Ce,a0 as Te,ba as Ae,P as re,aR as se,aP as qe}from"./index-BE75cmpZ.js";import{C as Pe}from"./CircularLoader-BPKp5USP.js";import{A as de,I as Se,a as De}from"./InvoiceModal-CjvbFqQK.js";import{u as Le,a as Fe,h as oe,b as ce,s as Ee,c as O,f as ke}from"./invoice-gwlodkUv.js";import{E as Ne}from"./Edit-8SBZdiAh.js";import{T as $e,a as Oe,b as Be}from"./TableContainer-s0yUIJEg.js";import{T as He}from"./TableHead-DpC64hQ0.js";import{T as ae}from"./TableRow-D1lYbwwu.js";import{T as p}from"./TableCell-BOHhKnuh.js";import{v as ze}from"./v4-CQkTLCs1.js";import{D as xe}from"./DatePicker-CGF5iLjA.js";import"./AlertProductDelete-oTlyPibh.js";import"./Skeleton-CpgMpkyu.js";import"./InputAdornment-CY-Tyt4a.js";import"./react-pdf.browser-DbCEHO18.js";import"./index-ZtNy4ppB.js";import"./index-Gd6rUEMS.js";import"./index-BwELBfiY.js";import"./DocumentDownload-DDJvvIVF.js";import"./dateViewRenderers-BUIkIYe-.js";import"./ListItem-eemVPKEi.js";import"./ListItemSecondaryAction-DuTfPZL3.js";import"./DesktopDatePicker-Dk1ljeGu.js";import"./useMobilePicker-zQDRri-P.js";const Re=N({date:ee().required("Invoice date is required"),due_date:ee().when("date",(r,d)=>r&&d.min(r,"Due date can't be before invoice date")).nullable().required("Due date is required"),customerInfo:N({name:$().required("Invoice receiver information is required")}).required("Invoice receiver information is required"),status:$().required("Status selection is required"),invoice_detail:fe().required("Invoice details is required").of(N().shape({name:$().required("Product name is required")})).min(1,"Invoice must have at least 1 items")}),le={name:"",address:"",phone:"",email:""};function me({list:r,invoiceMaster:d}){const g=ye(),L=ge(),b=500,q=c=>{var l,u,i;const s={id:Number(r==null?void 0:r.id),invoice_id:Number(c.invoice_id),customer_name:(l=c.cashierInfo)==null?void 0:l.name,email:(u=c.cashierInfo)==null?void 0:u.email,avatar:Number(r==null?void 0:r.avatar),discount:Number(c.discount),tax:Number(c.tax),date:se(new Date(c.date),"MM/dd/yyyy"),due_date:se(new Date(c.due_date),"MM/dd/yyyy"),quantity:Number((i=c.invoice_detail)==null?void 0:i.reduce((F,f)=>F+f.qty,0)),status:c.status,cashierInfo:c.cashierInfo,customerInfo:c.customerInfo,invoice_detail:c.invoice_detail,notes:c.notes};ke(s.id,s),qe({open:!0,message:"Invoice Updated successfully",anchorOrigin:{vertical:"top",horizontal:"right"},variant:"alert",alert:{color:"success"},close:!0}),L("/apps/invoice/list")};return e.jsx(be,{enableReinitialize:!0,initialValues:{id:r.id||"",invoice_id:r.invoice_id||"",status:r.status||"",date:new Date(r.date)||null,due_date:new Date(r.due_date)||null,cashierInfo:r.cashierInfo||le,customerInfo:r.customerInfo||le,invoice_detail:r.invoice_detail||[],discount:r.discount||0,tax:r.tax||0,notes:r.notes||""},validationSchema:Re,onSubmit:c=>{q(c)},children:({handleBlur:c,errors:s,handleChange:l,handleSubmit:u,values:i,isValid:F,setFieldValue:f,touched:m})=>{var H,z,R,M,U,W,G,Y,J,K;const I=((H=i==null?void 0:i.invoice_detail)==null?void 0:H.reduce((n,o)=>o.name.trim().length>0?n+Number(o.price*Math.floor(o.qty)):n,0))||0,E=(i==null?void 0:i.tax)*I/100,k=i.discount*I/100,P=I-k+E;return e.jsx(Ie,{onSubmit:u,children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(a,{spacing:1,children:[e.jsx(j,{children:"Invoice Id"}),e.jsx(_,{sx:{width:"100%"},children:e.jsx(C,{required:!0,disabled:!0,type:"number",name:"invoice_id",id:"invoice_id",value:i.invoice_id,onChange:l})})]})}),e.jsxs(t,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(a,{spacing:1,children:[e.jsx(j,{children:"Status"}),e.jsx(_,{sx:{width:"100%"},children:e.jsxs(we,{value:i.status,displayEmpty:!0,name:"status",renderValue:n=>n.length===0?e.jsx(y,{sx:{color:"secondary.400"},children:"Select status"}):n,onChange:l,error:!!(s.status&&m.status),children:[e.jsx(D,{disabled:!0,value:"",children:"Select status"}),e.jsx(D,{value:"Paid",children:"Paid"}),e.jsx(D,{value:"Unpaid",children:"Unpaid"}),e.jsx(D,{value:"Cancelled",children:"Cancelled"})]})})]}),m.status&&s.status&&e.jsx(T,{error:!0,children:s.status})]}),e.jsxs(t,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(a,{spacing:1,children:[e.jsx(j,{children:"Date"}),e.jsx(_,{sx:{width:"100%"},error:!!(m.date&&s.date),children:e.jsx(ie,{dateAdapter:ne,children:e.jsx(xe,{format:"dd/MM/yyyy",value:i.date,onChange:n=>f("date",n)})})})]}),m.date&&s.date&&e.jsx(T,{error:!0,children:s.date})]}),e.jsxs(t,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(a,{spacing:1,children:[e.jsx(j,{children:"Due Date"}),e.jsx(_,{sx:{width:"100%"},error:!!(m.due_date&&s.due_date),children:e.jsx(ie,{dateAdapter:ne,children:e.jsx(xe,{format:"dd/MM/yyyy",value:i.due_date,onChange:n=>f("due_date",n)})})})]}),m.due_date&&s.due_date&&e.jsx(T,{error:!0,children:s.due_date})]}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(B,{sx:{minHeight:168},children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsx(t,{item:!0,xs:12,sm:8,children:e.jsxs(a,{spacing:2,children:[e.jsx(x,{variant:"h5",children:"From:"}),e.jsxs(a,{sx:{width:"100%"},children:[e.jsx(x,{variant:"subtitle1",children:(z=i==null?void 0:i.cashierInfo)==null?void 0:z.name}),e.jsx(x,{color:"secondary",children:(R=i==null?void 0:i.cashierInfo)==null?void 0:R.address}),e.jsx(x,{color:"secondary",children:(M=i==null?void 0:i.cashierInfo)==null?void 0:M.phone}),e.jsx(x,{color:"secondary",children:(U=i==null?void 0:i.cashierInfo)==null?void 0:U.email})]})]})}),e.jsx(t,{item:!0,xs:12,sm:4,children:e.jsxs(y,{textAlign:{xs:"left",sm:"right"},color:"grey.200",children:[e.jsx(A,{variant:"outlined",startIcon:e.jsx(Ne,{}),color:"secondary",onClick:()=>oe(!0),size:"small",children:"Change"}),e.jsx(de,{open:d.open,setOpen:n=>oe(n),handlerAddress:n=>f("cashierInfo",n)})]})})]})})}),e.jsxs(t,{item:!0,xs:12,sm:6,children:[e.jsx(B,{sx:{minHeight:168},children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsx(t,{item:!0,xs:12,sm:8,children:e.jsxs(a,{spacing:2,children:[e.jsx(x,{variant:"h5",children:"To:"}),e.jsxs(a,{sx:{width:"100%"},children:[e.jsx(x,{variant:"subtitle1",children:(W=i==null?void 0:i.customerInfo)==null?void 0:W.name}),e.jsx(x,{color:"secondary",children:(G=i==null?void 0:i.customerInfo)==null?void 0:G.address}),e.jsx(x,{color:"secondary",children:(Y=i==null?void 0:i.customerInfo)==null?void 0:Y.phone}),e.jsx(x,{color:"secondary",children:(J=i==null?void 0:i.customerInfo)==null?void 0:J.email})]})]})}),e.jsx(t,{item:!0,xs:12,sm:4,children:e.jsxs(y,{textAlign:"right",color:"secondary.200",children:[e.jsx(A,{size:"small",startIcon:e.jsx(te,{}),color:"secondary",variant:"outlined",onClick:()=>ce(!0),children:"Add"}),e.jsx(de,{open:d.isCustomerOpen,setOpen:n=>ce(n),handlerAddress:n=>f("customerInfo",n)})]})})]})}),m.customerInfo&&s.customerInfo&&e.jsx(T,{error:!0,children:(K=s==null?void 0:s.customerInfo)==null?void 0:K.name})]}),e.jsx(t,{item:!0,xs:12,children:e.jsx(x,{variant:"h5",children:"Detail"})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(_e,{name:"invoice_detail",render:({remove:n,push:o})=>{var S,w,Q,V,X,Z;return e.jsxs(e.Fragment,{children:[e.jsx($e,{children:e.jsxs(Oe,{sx:{minWidth:650},children:[e.jsx(He,{children:e.jsxs(ae,{children:[e.jsx(p,{children:"#"}),e.jsx(p,{children:"Name"}),e.jsx(p,{children:"Description"}),e.jsx(p,{children:"Qty"}),e.jsx(p,{children:"Price"}),e.jsx(p,{align:"right",children:"Amount"}),e.jsx(p,{align:"center",children:"Action"})]})}),e.jsx(Be,{children:(S=i==null?void 0:i.invoice_detail)==null?void 0:S.map((h,he)=>e.jsxs(ae,{children:[e.jsx(p,{children:(i==null?void 0:i.invoice_detail.indexOf(h))+1}),e.jsx(Se,{id:h.id,index:he,name:h.name,description:h.description,qty:h.qty,price:h.price,onDeleteItem:je=>n(je),onEditItem:l,Blur:c,errors:s,touched:m},h.id)]},h.id))})]})}),e.jsx(Ce,{}),m.invoice_detail&&s.invoice_detail&&!Array.isArray(s==null?void 0:s.invoice_detail)&&e.jsx(a,{direction:"row",justifyContent:"center",sx:{p:1.5},children:e.jsx(T,{error:!0,children:s.invoice_detail})}),e.jsxs(t,{container:!0,justifyContent:"space-between",children:[e.jsx(t,{item:!0,xs:12,md:8,children:e.jsx(y,{sx:{pt:2.5,pr:2.5,pb:2.5,pl:0},children:e.jsx(A,{color:"primary",startIcon:e.jsx(te,{}),onClick:()=>o({id:ze(),name:"",description:"",qty:1,price:"1.00"}),variant:"dashed",sx:{bgcolor:"transparent !important"},children:"Add Item"})})}),e.jsxs(t,{item:!0,xs:12,md:4,children:[e.jsxs(t,{container:!0,justifyContent:"space-between",spacing:2,sx:{pt:2.5,pb:2.5},children:[e.jsx(t,{item:!0,xs:6,children:e.jsxs(a,{spacing:1,children:[e.jsx(j,{children:"Discount(%)"}),e.jsx(C,{type:"number",fullWidth:!0,name:"discount",id:"discount",placeholder:"0.0",value:i.discount,onChange:l,inputProps:{min:0}})]})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(a,{spacing:1,children:[e.jsx(j,{children:"Tax(%)"}),e.jsx(C,{type:"number",fullWidth:!0,name:"tax",id:"tax",placeholder:"0.0",value:i.tax,onChange:l,inputProps:{min:0}})]})})]}),e.jsx(t,{item:!0,xs:12,children:e.jsxs(a,{spacing:2,children:[e.jsxs(a,{direction:"row",justifyContent:"space-between",children:[e.jsx(x,{color:g.palette.secondary.main,children:"Sub Total:"}),e.jsx(x,{children:((w=d.country)==null?void 0:w.prefix)+""+I.toFixed(2)})]}),e.jsxs(a,{direction:"row",justifyContent:"space-between",children:[e.jsx(x,{color:g.palette.secondary.main,children:"Discount:"}),e.jsx(x,{variant:"h6",color:"success.main",children:((Q=d.country)==null?void 0:Q.prefix)+""+k.toFixed(2)})]}),e.jsxs(a,{direction:"row",justifyContent:"space-between",children:[e.jsx(x,{color:g.palette.secondary.main,children:"Tax:"}),e.jsx(x,{children:((V=d.country)==null?void 0:V.prefix)+""+E.toFixed(2)})]}),e.jsxs(a,{direction:"row",justifyContent:"space-between",children:[e.jsx(x,{variant:"subtitle1",children:"Grand Total:"}),e.jsx(x,{variant:"subtitle1",children:P%1===0?((X=d.country)==null?void 0:X.prefix)+""+P:((Z=d.country)==null?void 0:Z.prefix)+""+P.toFixed(2)})]})]})})]})]})]})}})}),e.jsx(t,{item:!0,xs:12,children:e.jsxs(a,{spacing:1,children:[e.jsx(j,{children:"Notes"}),e.jsx(C,{fullWidth:!0,placeholder:"Address",rows:3,value:i.notes,multiline:!0,name:"notes",onChange:l,inputProps:{maxLength:b},helperText:`${i.notes.length} / ${b}`,sx:{"& .MuiFormHelperText-root":{mr:0,display:"flex",justifyContent:"flex-end"}}})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(a,{spacing:1,children:[e.jsx(j,{children:"Set Currency*"}),e.jsx(_,{sx:{width:{xs:"100%",sm:250}},children:e.jsx(Te,{id:"country-select-demo",fullWidth:!0,options:d.countries,defaultValue:d.countries[2],value:d.countries.find(n=>{var o;return n.code===((o=d.country)==null?void 0:o.code)}),onChange:(n,o)=>Ee(o),autoHighlight:!0,getOptionLabel:n=>n.label,renderOption:(n,o)=>e.jsxs(y,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...n,children:[o.code&&e.jsx("img",{loading:"lazy",width:"20",src:`https://flagcdn.com/w20/${o.code.toLowerCase()}.png`,srcSet:`https://flagcdn.com/w40/${o.code.toLowerCase()}.png 2x`,alt:""}),o.label]}),renderInput:n=>{const o=d.countries.find(S=>{var w;return S.code===((w=d.country)==null?void 0:w.code)});return e.jsx(C,{...n,name:"phoneCode",placeholder:"Select",InputProps:{...n.InputProps,startAdornment:e.jsx(e.Fragment,{children:o&&o.code!==""&&e.jsx("img",{style:{marginRight:6},loading:"lazy",width:"20",src:`https://flagcdn.com/w20/${o.code.toLowerCase()}.png`,srcSet:`https://flagcdn.com/w40/${o.code.toLowerCase()}.png 2x`,alt:""})})},inputProps:{...n.inputProps,autoComplete:"new-password"}})}})})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(a,{direction:"row",justifyContent:"flex-end",alignItems:"flex-end",spacing:2,sx:{height:"100%"},children:[e.jsx(A,{variant:"outlined",color:"secondary",disabled:!F,sx:{color:"secondary.dark"},onClick:()=>O(!0),children:"Preview"}),e.jsx(A,{color:"primary",variant:"contained",type:"submit",children:"Update & Send"}),e.jsx(De,{isOpen:d.isOpen,setIsOpen:n=>O(n),invoiceInfo:{...i,subtotal:I,taxRate:E,discountRate:k,total:P},items:i==null?void 0:i.invoice_detail,onAddNextInvoice:()=>O(!1)},i.invoice_id)]})})]})})}})}function mi(){const{id:r}=pe(),{invoiceLoading:d,invoice:g}=Le(),{invoiceMasterLoading:L,invoiceMaster:b}=Fe(),[q,c]=v.useState(null);v.useEffect(()=>{r&&!d&&c(g.filter(i=>i.id.toString()===r)[0])},[r,d]);const s=e.jsx(y,{sx:{height:"calc(100vh - 310px)"},children:e.jsx(Pe,{})});let l=[{title:"Home",to:Ae},{title:"Invoice",to:"/apps/invoice/dashboard"},{title:"Edit"}];const u=d||L||b===void 0||q===null;return e.jsxs(e.Fragment,{children:[e.jsx(ue,{custom:!0,heading:"Edit Invoice",links:l}),e.jsx(B,{children:u?s:e.jsx(me,{list:q,invoiceMaster:b})})]})}me.propTypes={list:re.any,invoiceMaster:re.any};export{mi as default};
