import{j as e,b9 as he,M as O,aW as $,aY as v,aX as B,bo as je,c as pe,bp as ue,bq as ye,b1 as fe,G as n,S as o,J as h,U as w,n as C,V as ge,B as g,Y as D,b4 as _,a$ as Z,b0 as ee,T as d,d as f,K as ie,br as be,F as Ie,a0 as we,ba as Ce,P as te,aR as ne,aP as _e}from"./index-BE75cmpZ.js";import{C as Te}from"./CircularLoader-BPKp5USP.js";import{A as re,I as Ae,a as qe}from"./InvoiceModal-CjvbFqQK.js";import{i as Pe}from"./incrementer-QD2bX8Yz.js";import{u as De,a as Se,h as se,b as oe,s as Fe,c as M,i as Le}from"./invoice-gwlodkUv.js";import{v as de}from"./v4-CQkTLCs1.js";import{D as ce}from"./DatePicker-CGF5iLjA.js";import{E as ke}from"./Edit-8SBZdiAh.js";import{T as Ne,a as $e,b as Be}from"./TableContainer-s0yUIJEg.js";import{T as Me}from"./TableHead-DpC64hQ0.js";import{T as ae}from"./TableRow-D1lYbwwu.js";import{T as j}from"./TableCell-BOHhKnuh.js";import"./AlertProductDelete-oTlyPibh.js";import"./Skeleton-CpgMpkyu.js";import"./InputAdornment-CY-Tyt4a.js";import"./react-pdf.browser-DbCEHO18.js";import"./index-ZtNy4ppB.js";import"./index-Gd6rUEMS.js";import"./index-BwELBfiY.js";import"./DocumentDownload-DDJvvIVF.js";import"./dateViewRenderers-BUIkIYe-.js";import"./ListItem-eemVPKEi.js";import"./ListItemSecondaryAction-DuTfPZL3.js";import"./DesktopDatePicker-Dk1ljeGu.js";import"./useMobilePicker-zQDRri-P.js";const Oe=$({date:v().required("Invoice date is required"),due_date:v().when("date",(p,c)=>p&&c.min(p,"Due date can't be before invoice date")).nullable().required("Due date is required"),customerInfo:$({name:B().required("Invoice receiver information is required")}).required("Invoice receiver information is required"),status:B().required("Status selection is required"),invoice_detail:je().required("Invoice details is required").of($().shape({name:B().required("Product name is required")})).min(1,"Invoice must have at least 1 items")});function le({lists:p,invoiceMaster:c}){const u=pe(),S=ue(),T=500,F=a=>{var l,A,i;const r={id:Number(Pe(p.length)),invoice_id:Number(a.invoice_id),customer_name:(l=a.cashierInfo)==null?void 0:l.name,email:(A=a.cashierInfo)==null?void 0:A.email,avatar:Number(Math.round(Math.random()*10)),discount:Number(a.discount),tax:Number(a.tax),date:ne(new Date(a.date),"MM/dd/yyyy"),due_date:ne(new Date(a.due_date),"MM/dd/yyyy"),quantity:Number((i=a.invoice_detail)==null?void 0:i.reduce((L,y)=>L+y.qty,0)),status:a.status,cashierInfo:a.cashierInfo,customerInfo:a.customerInfo,invoice_detail:a.invoice_detail,notes:a.notes};Le(r),_e({open:!0,message:"Invoice Added successfully",anchorOrigin:{vertical:"top",horizontal:"right"},variant:"alert",alert:{color:"success"}}),S("/apps/invoice/list")};return e.jsx(ye,{initialValues:{id:120,invoice_id:Date.now(),status:"",date:new Date,due_date:null,cashierInfo:{name:"Belle J. Richter",address:"1300 Cooks Mine, NM 87829",phone:"305-829-7809",email:"belljrc23@gmail.com"},customerInfo:{address:"",email:"",name:"",phone:""},invoice_detail:[{id:de(),name:"",description:"",qty:1,price:"1.00"}],discount:0,tax:0,notes:""},validationSchema:Oe,onSubmit:a=>{F(a)},children:({handleBlur:a,errors:r,handleChange:l,handleSubmit:A,values:i,isValid:L,setFieldValue:y,touched:x})=>{var H,R,z,E,G,W,U,J,Y;const b=i==null?void 0:i.invoice_detail.reduce((t,s)=>s.name.trim().length>0?t+Number(s.price*Math.floor(s.qty)):t,0),k=i.tax*b/100,N=i.discount*b/100,q=b-N+k;return e.jsx(fe,{onSubmit:A,children:e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(o,{spacing:1,children:[e.jsx(h,{children:"Invoice Id"}),e.jsx(w,{sx:{width:"100%"},children:e.jsx(C,{required:!0,disabled:!0,type:"number",name:"invoice_id",id:"invoice_id",value:i.invoice_id,onChange:l})})]})}),e.jsxs(n,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(o,{spacing:1,children:[e.jsx(h,{children:"Status"}),e.jsx(w,{sx:{width:"100%"},children:e.jsxs(ge,{value:i.status,displayEmpty:!0,name:"status",renderValue:t=>t.length===0?e.jsx(g,{sx:{color:"secondary.400"},children:"Select status"}):t,onChange:l,error:!!(r.status&&x.status),children:[e.jsx(D,{disabled:!0,value:"",children:"Select status"}),e.jsx(D,{value:"Paid",children:"Paid"}),e.jsx(D,{value:"Unpaid",children:"Unpaid"}),e.jsx(D,{value:"Cancelled",children:"Cancelled"})]})})]}),x.status&&r.status&&e.jsx(_,{error:!0,children:r.status})]}),e.jsxs(n,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(o,{spacing:1,children:[e.jsx(h,{children:"Date"}),e.jsx(w,{sx:{width:"100%"},error:!!(x.date&&r.date),children:e.jsx(Z,{dateAdapter:ee,children:e.jsx(ce,{format:"dd/MM/yyyy",value:i.date,onChange:t=>y("date",t)})})})]}),x.date&&r.date&&e.jsx(_,{error:!0,children:r.date})]}),e.jsxs(n,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(o,{spacing:1,children:[e.jsx(h,{children:"Due Date"}),e.jsx(w,{sx:{width:"100%"},error:!!(x.due_date&&r.due_date),children:e.jsx(Z,{dateAdapter:ee,children:e.jsx(ce,{format:"dd/MM/yyyy",value:i.due_date,onChange:t=>y("due_date",t)})})})]}),x.due_date&&r.due_date&&e.jsx(_,{error:!0,children:r.due_date})]}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(O,{sx:{minHeight:168},children:e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:8,children:e.jsxs(o,{spacing:2,children:[e.jsx(d,{variant:"h5",children:"From:"}),e.jsxs(o,{sx:{width:"100%"},children:[e.jsx(d,{variant:"subtitle1",children:(H=i==null?void 0:i.cashierInfo)==null?void 0:H.name}),e.jsx(d,{color:"secondary",children:(R=i==null?void 0:i.cashierInfo)==null?void 0:R.address}),e.jsx(d,{color:"secondary",children:(z=i==null?void 0:i.cashierInfo)==null?void 0:z.phone}),e.jsx(d,{color:"secondary",children:(E=i==null?void 0:i.cashierInfo)==null?void 0:E.email})]})]})}),e.jsx(n,{item:!0,xs:12,sm:4,children:e.jsxs(g,{textAlign:{xs:"left",sm:"right"},color:"secondary.200",children:[e.jsx(f,{variant:"outlined",startIcon:e.jsx(ke,{}),color:"secondary",onClick:()=>se(!0),size:"small",children:"Change"}),e.jsx(re,{open:c.open,setOpen:t=>se(t),handlerAddress:t=>y("cashierInfo",t)})]})})]})})}),e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(O,{sx:{minHeight:168},children:e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:8,children:e.jsxs(o,{spacing:2,children:[e.jsx(d,{variant:"h5",children:"To:"}),e.jsxs(o,{sx:{width:"100%"},children:[e.jsx(d,{variant:"subtitle1",children:(G=i==null?void 0:i.customerInfo)==null?void 0:G.name}),e.jsx(d,{color:"secondary",children:(W=i==null?void 0:i.customerInfo)==null?void 0:W.address}),e.jsx(d,{color:"secondary",children:(U=i==null?void 0:i.customerInfo)==null?void 0:U.phone}),e.jsx(d,{color:"secondary",children:(J=i==null?void 0:i.customerInfo)==null?void 0:J.email})]})]})}),e.jsx(n,{item:!0,xs:12,sm:4,children:e.jsxs(g,{textAlign:"right",color:"grey.200",children:[e.jsx(f,{size:"small",startIcon:e.jsx(ie,{}),color:"secondary",variant:"outlined",onClick:()=>oe(!0),children:"Add"}),e.jsx(re,{open:c.isCustomerOpen,setOpen:t=>oe(t),handlerAddress:t=>y("customerInfo",t)})]})})]})}),x.customerInfo&&r.customerInfo&&e.jsx(_,{error:!0,children:(Y=r==null?void 0:r.customerInfo)==null?void 0:Y.name})]}),e.jsx(n,{item:!0,xs:12,children:e.jsx(d,{variant:"h5",children:"Detail"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(be,{name:"invoice_detail",render:({remove:t,push:s})=>{var P,I,K,Q,V,X;return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{children:e.jsxs($e,{sx:{minWidth:650},children:[e.jsx(Me,{children:e.jsxs(ae,{children:[e.jsx(j,{children:"#"}),e.jsx(j,{children:"Name"}),e.jsx(j,{children:"Description"}),e.jsx(j,{children:"Qty"}),e.jsx(j,{children:"Price"}),e.jsx(j,{align:"right",children:"Amount"}),e.jsx(j,{align:"center",children:"Action"})]})}),e.jsx(Be,{children:(P=i.invoice_detail)==null?void 0:P.map((m,xe)=>e.jsxs(ae,{children:[e.jsx(j,{children:i.invoice_detail.indexOf(m)+1}),e.jsx(Ae,{id:m.id,index:xe,name:m.name,description:m.description,qty:m.qty,price:m.price,onDeleteItem:me=>t(me),onEditItem:l,Blur:a,errors:r,touched:x},m.id)]},m.id))})]})}),e.jsx(Ie,{}),x.invoice_detail&&r.invoice_detail&&!Array.isArray(r==null?void 0:r.invoice_detail)&&e.jsx(o,{direction:"row",justifyContent:"center",sx:{p:1.5},children:e.jsx(_,{error:!0,children:r.invoice_detail})}),e.jsxs(n,{container:!0,justifyContent:"space-between",children:[e.jsx(n,{item:!0,xs:12,md:8,children:e.jsx(g,{sx:{pt:2.5,pr:2.5,pb:2.5,pl:0},children:e.jsx(f,{color:"primary",startIcon:e.jsx(ie,{}),onClick:()=>s({id:de(),name:"",description:"",qty:1,price:"1.00"}),variant:"dashed",sx:{bgcolor:"transparent !important"},children:"Add Item"})})}),e.jsxs(n,{item:!0,xs:12,md:4,children:[e.jsxs(n,{container:!0,justifyContent:"space-between",spacing:2,sx:{pt:2.5,pb:2.5},children:[e.jsx(n,{item:!0,xs:6,children:e.jsxs(o,{spacing:1,children:[e.jsx(h,{children:"Discount(%)"}),e.jsx(C,{type:"number",fullWidth:!0,name:"discount",id:"discount",placeholder:"0.0",value:i.discount,onChange:l,inputProps:{min:0}})]})}),e.jsx(n,{item:!0,xs:6,children:e.jsxs(o,{spacing:1,children:[e.jsx(h,{children:"Tax(%)"}),e.jsx(C,{type:"number",fullWidth:!0,name:"tax",id:"tax",placeholder:"0.0",value:i.tax,onChange:l,inputProps:{min:0}})]})})]}),e.jsx(n,{item:!0,xs:12,children:e.jsxs(o,{spacing:2,children:[e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(d,{color:u.palette.secondary.main,children:"Sub Total:"}),e.jsx(d,{children:((I=c.country)==null?void 0:I.prefix)+""+b.toFixed(2)})]}),e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(d,{color:u.palette.secondary.main,children:"Discount:"}),e.jsx(d,{variant:"h6",color:"success.main",children:((K=c.country)==null?void 0:K.prefix)+""+N.toFixed(2)})]}),e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(d,{color:u.palette.secondary.main,children:"Tax:"}),e.jsx(d,{children:((Q=c.country)==null?void 0:Q.prefix)+""+k.toFixed(2)})]}),e.jsxs(o,{direction:"row",justifyContent:"space-between",children:[e.jsx(d,{variant:"subtitle1",children:"Grand Total:"}),e.jsxs(d,{variant:"subtitle1",children:[" ",q%1===0?((V=c.country)==null?void 0:V.prefix)+""+q:((X=c.country)==null?void 0:X.prefix)+""+q.toFixed(2)]})]})]})})]})]})]})}})}),e.jsx(n,{item:!0,xs:12,children:e.jsxs(o,{spacing:1,children:[e.jsx(h,{children:"Notes"}),e.jsx(C,{placeholder:"Address",rows:3,value:i.notes,multiline:!0,name:"notes",onChange:l,inputProps:{maxLength:T},helperText:`${i.notes.length} / ${T}`,sx:{width:"100%","& .MuiFormHelperText-root":{mr:0,display:"flex",justifyContent:"flex-end"}}})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(o,{spacing:1,children:[e.jsx(h,{children:"Set Currency*"}),e.jsx(w,{sx:{width:{xs:"100%",sm:250}},children:e.jsx(we,{id:"country-select-demo",fullWidth:!0,options:c.countries,defaultValue:c.countries[2],value:c.countries.find(t=>{var s;return t.code===((s=c.country)==null?void 0:s.code)}),onChange:(t,s)=>Fe(s),autoHighlight:!0,getOptionLabel:t=>t.label,renderOption:(t,s)=>e.jsxs(g,{component:"li",sx:{display:"flex",direction:"row",alignItems:"center",gap:1},...t,children:[s.code&&e.jsx("img",{loading:"lazy",width:"20",src:`https://flagcdn.com/w20/${s.code.toLowerCase()}.png`,srcSet:`https://flagcdn.com/w40/${s.code.toLowerCase()}.png 2x`,alt:""}),s.label]}),renderInput:t=>{const s=c.countries.find(P=>{var I;return P.code===((I=c.country)==null?void 0:I.code)});return e.jsx(C,{...t,name:"phoneCode",placeholder:"Select",InputProps:{...t.InputProps,startAdornment:e.jsx(e.Fragment,{children:s&&s.code!==""&&e.jsx("img",{style:{marginRight:6},loading:"lazy",width:"20",src:`https://flagcdn.com/w20/${s.code.toLowerCase()}.png`,srcSet:`https://flagcdn.com/w40/${s.code.toLowerCase()}.png 2x`,alt:""})})},inputProps:{...t.inputProps,autoComplete:"new-password"}})}})})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(o,{direction:"row",justifyContent:"flex-end",alignItems:"flex-end",spacing:2,sx:{height:"100%"},children:[e.jsx(f,{variant:"outlined",color:"secondary",disabled:i.status===""||!L,sx:{color:"secondary.dark"},onClick:()=>M(!0),children:"Preview"}),e.jsx(f,{variant:"outlined",color:"secondary",sx:{color:"secondary.dark"},children:"Save"}),e.jsx(f,{color:"primary",variant:"contained",type:"submit",children:"Create & Send"}),e.jsx(qe,{isOpen:c.isOpen,setIsOpen:t=>M(t),invoiceInfo:{...i,subtotal:b,taxRate:k,discountRate:N,total:q},items:i==null?void 0:i.invoice_detail,onAddNextInvoice:()=>M(!1)},i.invoice_id)]})})]})})}})}function li(){const{invoice:p}=De(),{invoiceMasterLoading:c,invoiceMaster:u}=Se(),S=c||u===void 0,T=e.jsx(g,{sx:{height:"calc(100vh - 310px)"},children:e.jsx(Te,{})});let F=[{title:"Home",to:Ce},{title:"Invoice",to:"/apps/invoice/dashboard"},{title:"Create Invoice"}];return e.jsxs(e.Fragment,{children:[e.jsx(he,{custom:!0,heading:"New Invoice",links:F}),e.jsx(O,{children:S?T:e.jsx(le,{lists:p,invoiceMaster:u})})]})}le.propTypes={lists:te.array,invoiceMaster:te.any};export{li as default};
